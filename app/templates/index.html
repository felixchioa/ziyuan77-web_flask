<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="description" content="èµ„æº77ä¸»é¡µï¼ŒåŒ…æ‹¬é¡¹ç›®ã€æ—¥å¸¸ã€å·¥å…·ã€èµ„æºç«™ã€åšå®¢ã€äº”å­æ£‹ã€å¸¸ç”¨æ§åˆ¶å°å‘½ä»¤åŠå…¶å‚æ•°ã€ç½‘ç«™æ›´æ–°ã€ç½‘ç«™æºç ç­‰ï¼Œæ–¹ä¾¿å¿«æ·ã€‚">
        <title>77èµ„æºç«™ï¼Œæä¾›å„ç§æœ‰ç”¨çš„å·¥å…·å’Œèµ„æº</title>
        <link rel="stylesheet" href="/static/css/index.css" />
        <style>
        .network-info {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        .network-info-header {
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 5px;
        }

        .network-info-header:hover {
            background-color: #f0f0f0;
        }

        .network-info-content {
            display: none;
        }

        .network-info-content.show {
            display: block;
        }

        .toggle-icon {
            margin-right: 10px;
            transition: transform 0.3s ease;
        }

        .toggle-icon.rotated {
            transform: rotate(90deg);
        }

        .info-item {
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
        }

        .info-label {
            font-weight: bold;
            color: #333;
        }

        .info-value {
            margin-left: 10px;
        }

        /* æ—¶é—´æ˜¾ç¤ºçš„åŸºç¡€æ ·å¼ */
        .time-display {
            margin: 20px 0;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.2em;
            position: relative;
        }

        /* æ ·å¼1ï¼šé»˜è®¤ç®€çº¦é£æ ¼ */
        .time-style-1 {
            background-color: #f8f9fa;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .time-style-1 .time-label { color: #333; }
        .time-style-1 .time-value { color: #007bff; }

        /* æ ·å¼2ï¼šæ·±è‰²ç°ä»£é£æ ¼ */
        .time-style-2 {
            background-color: #2c3e50;
            color: white;
        }
        .time-style-2 .time-label { color: #ecf0f1; }
        .time-style-2 .time-value { color: #3498db; }

        /* æ ·å¼3ï¼šæ¸å˜é£æ ¼ */
        .time-style-3 {
            background: linear-gradient(135deg, #6dd5ed, #2193b0);
            color: white;
        }
        .time-style-3 .time-label { color: #fff; }
        .time-style-3 .time-value { color: #ffeb3b; }

        /* æ ·å¼4ï¼šè¾¹æ¡†é£æ ¼ */
        .time-style-4 {
            background-color: white;
            border: 2px solid #e74c3c;
        }
        .time-style-4 .time-label { color: #c0392b; }
        .time-style-4 .time-value { color: #e74c3c; }

        /* æ ·å¼5ï¼šæç®€é£æ ¼ */
        .time-style-5 {
            background-color: transparent;
            border-bottom: 2px solid #34495e;
        }
        .time-style-5 .time-label { color: #7f8c8d; }
        .time-style-5 .time-value { color: #34495e; }

        /* æ ·å¼é€‰æ‹©å™¨ */
        .style-selector {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .style-selector select {
            padding: 2px 5px;
            border-radius: 3px;
            border: 1px solid #ddd;
            background-color: white;
        }

        .device-info {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            background-color: #f9f9f9;
        }

        .device-info-header {
            cursor: pointer;
            display: flex;
            align-items: center;
            padding: 5px;
        }

        .device-info-header:hover {
            background-color: #f0f0f0;
        }

        .device-info-content {
            display: none;
        }

        .device-info-content.show {
            display: block;
        }

        .test-btn {
            margin-left: 10px;
            padding: 2px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            background-color: #f8f9fa;
            cursor: pointer;
            font-size: 12px;
            transition: background-color 0.2s;
        }

        .test-btn:hover {
            background-color: #e9ecef;
        }

        .test-btn:active {
            background-color: #dee2e6;
        }

        .test-btn.testing {
            background-color: #e9ecef;
            cursor: not-allowed;
            opacity: 0.7;
        }
        </style>
    </head>
    <body>
        <div class="container">
            <div class="sidebar">
                <ul>
                    <li><a href="/projects">é¡¹ç›®</a></li>
                    <li><a href="/daily">æ—¥å¸¸</a></li>
                    <li><a href="/tools">å·¥å…·</a></li>
                    <li><a href="https://file.ziyuan77.com" target="_blank">èµ„æºç«™</a></li>
                    <li><a href="https://blog.ziyuan77.com" target="_blank">åšå®¢</a></li>
                    <li><a href="/gomoku">äº”å­æ£‹ï¼Œå¯è”æœºå¯¹æˆ˜</a></li>
                    <li><a href="/cmd_commands">å¸¸ç”¨æ§åˆ¶å°å‘½ä»¤åŠå…¶å‚æ•°</a></li>
                </ul>
            </div>
            <div class="content">
                <h1>ziyuan77çš„ç½‘ç«™</h1>
                
                <h3>æ¬¢è¿æ¥åˆ°ziyuan77çš„ç½‘ç«™ï¼Œè¿™é‡Œæä¾›å„ç§æœ‰ç”¨çš„å·¥å…·å’Œèµ„æºã€‚</h3>
                
                <div class="time-display time-style-1">
                    <span class="time-label">å½“å‰æ—¶é—´ (UTC+8):</span>
                    <span class="time-value" id="current-time">{{ current_time }}</span>
                    <div class="style-selector">
                        <select onchange="changeTimeStyle(this.value)">
                            <option value="1">ç®€çº¦é£æ ¼</option>
                            <option value="2">æ·±è‰²ç°ä»£</option>
                            <option value="3">æ¸å˜é£æ ¼</option>
                            <option value="4">è¾¹æ¡†é£æ ¼</option>
                            <option value="5">æç®€é£æ ¼</option>
                        </select>
                    </div>
                </div>

                <div id="audio-container">
                    <!-- éŸ³é¢‘å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
                </div>

                <div class="device-info">
                    <div class="device-info-header" onclick="toggleDeviceInfo()">
                        <span class="toggle-icon">â–¶</span>
                        <span>è®¾å¤‡ä¿¡æ¯</span>
                    </div>
                    <div class="device-info-content">
                        <div class="info-item">
                            <span class="info-label">æµè§ˆå™¨:</span>
                            <span class="info-value" id="browser-info">æ£€æµ‹ä¸­...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æµè§ˆå™¨è¯­è¨€:</span>
                            <span class="info-value" id="browser-language">æ£€æµ‹ä¸­...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æ“ä½œç³»ç»Ÿ:</span>
                            <span class="info-value" id="os-info">æ£€æµ‹ä¸­...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">è®¾å¤‡ç±»å‹:</span>
                            <span class="info-value" id="device-type">æ£€æµ‹ä¸­...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å±å¹•åˆ†è¾¨ç‡:</span>
                            <span class="info-value" id="screen-resolution">æ£€æµ‹ä¸­...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">åƒç´ æ¯”:</span>
                            <span class="info-value" id="pixel-ratio">æ£€æµ‹ä¸­...</span>
                        </div>
                    </div>
                </div>

                <div class="network-info">
                    <div class="network-info-header" onclick="toggleNetworkInfo()">
                        <span class="toggle-icon">â–¶</span>
                        <span>ç½‘ç»œä¿¡æ¯</span>
                    </div>
                    <div class="network-info-content">
                        <div class="info-item">
                            <span class="info-label">æ‚¨çš„IPåœ°å€:</span>
                            <span class="info-value" id="visitor-ip">{{ visitor_ip }} (æ¥è‡ª{{ location }})</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">æœåŠ¡å™¨å»¶è¿Ÿ:</span>
                            <span class="info-value" id="server-latency">ç­‰å¾…æµ‹è¯•</span>
                            <button class="test-btn" data-test="latency">æµ‹è¯•</button>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ä¸‹è½½é€Ÿåº¦:</span>
                            <span class="info-value" id="download-speed">ç­‰å¾…æµ‹è¯•</span>
                            <button class="test-btn" data-test="download">æµ‹è¯•</button>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ä¸Šä¼ é€Ÿåº¦:</span>
                            <span class="info-value" id="upload-speed">ç­‰å¾…æµ‹è¯•</span>
                            <button class="test-btn" data-test="upload">æµ‹è¯•</button>
                        </div>
                        <div class="info-item">
                            <span class="info-label">DNSè§£ææ—¶é—´:</span>
                            <span class="info-value" id="dns-lookup">ç­‰å¾…æµ‹è¯•</span>
                            <button class="test-btn" data-test="dns">æµ‹è¯•</button>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ç½‘ç»œç±»å‹:</span>
                            <span class="info-value" id="connection-type">æ£€æµ‹ä¸­...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">ç½‘ç»œçŠ¶æ€:</span>
                            <span class="info-value" id="connection-status">æ£€æµ‹ä¸­...</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">å¸¦å®½é™åˆ¶:</span>
                            <span class="info-value" id="bandwidth-limit">æ£€æµ‹ä¸­...</span>
                        </div>
                    </div>
                </div>

                <!-- æ·»åŠ æœ€è¿‘æ›´æ–°å’Œçƒ­é—¨å·¥å…·åŒºåŸŸ -->


                    <div class="section popular-tools">
                        <h2>çƒ­é—¨å·¥å…·</h2>
                        <div class="tool-grid">
                            <a href="/password" class="tool-item">
                                <span class="tool-icon">ğŸ”‘</span>
                                <span class="tool-name">å¯†ç ç”Ÿæˆå™¨</span>
                            </a>
                            <a href="/ping" class="tool-item">
                                <span class="tool-icon">ğŸ“Ÿ</span>
                                <span class="tool-name">ç½‘ç»œè”é€šæ€§æµ‹è¯•</span>
                            </a>
                            <a href="/calculator" class="tool-item">
                                <span class="tool-icon">ğŸ§®</span>
                                <span class="tool-name">è®¡ç®—å™¨</span>
                            </a>
                            <a href="/qrcode" class="tool-item">
                                <span class="tool-icon">ğŸ“±</span>
                                <span class="tool-name">äºŒç»´ç ç”Ÿæˆ</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="footer-links">
                    <a href="/feedback">æä¾›åé¦ˆ</a>
                    <span class="divider">|</span>
                    <a href="/github">ç½‘ç«™æºç </a>
                    <span class="divider">|</span>
                    <a href="/update">ç½‘ç«™æ›´æ–°</a>
                    <span class="divider">|</span>
                    <p>powered by <a href="https://aws.amazon.com" target="_blank">AWS</a> <a href="https://www.cloudflare.com" target="_blank">Cloudflare</a> <a href="https://github.com/fatedier/frp" target="_blank">frp</a></p>
                </div>
            </footer>
        </div>
        <script src="/static/js/index.js"></script>
        <script>
        function updateTime() {
            const timeElement = document.getElementById('current-time');
            const options = {
                timeZone: 'Asia/Shanghai',
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            };
            
            setInterval(() => {
                const now = new Date();
                timeElement.textContent = now.toLocaleString('zh-CN', options);
            }, 1000);
        }

        // æ·»åŠ èŠ‚æµå‡½æ•°
        function throttle(func, limit) {
            let inThrottle;
            return function(...args) {
                // å…ˆæ£€æŸ¥ç‚¹å‡»è¡Œä¸º
                if (clickMonitor.recordClick()) {
                    return; // å¦‚æœè§¦å‘äº†å¼ºåˆ¶å…³é—­ï¼Œç›´æ¥è¿”å›
                }
                
                const context = this;
                if (!inThrottle) {
                    func.apply(context, args);
                    inThrottle = true;
                    setTimeout(() => inThrottle = false, limit);
                }
            }
        }

        // ä¿®æ”¹æµ‹è¯•å‡½æ•°ï¼Œæ·»åŠ èŠ‚æµ
        const throttledLatencyTest = throttle(testLatency, 3000);  // 3ç§’å†…åªèƒ½æµ‹è¯•ä¸€æ¬¡
        const throttledDownloadTest = throttle(testDownloadSpeed, 5000);  // 5ç§’å†…åªèƒ½æµ‹è¯•ä¸€æ¬¡
        const throttledUploadTest = throttle(testUploadSpeed, 5000);  // 5ç§’å†…åªèƒ½æµ‹è¯•ä¸€æ¬¡
        const throttledDNSTest = throttle(testDNS, 3000);  // 3ç§’å†…åªèƒ½æµ‹è¯•ä¸€æ¬¡

        // ä¿®æ”¹æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        function updateButtonHandlers() {
            const buttons = document.querySelectorAll('.test-btn');
            buttons.forEach(button => {
                const originalOnClick = button.getAttribute('onclick');
                if (originalOnClick) {
                    switch(originalOnClick) {
                        case 'testLatency()':
                            button.onclick = () => throttledLatencyTest();
                            break;
                        case 'testDownloadSpeed()':
                            button.onclick = () => throttledDownloadTest();
                            break;
                        case 'testUploadSpeed()':
                            button.onclick = () => throttledUploadTest();
                            break;
                        case 'testDNS()':
                            button.onclick = () => throttledDNSTest();
                            break;
                    }
                }
            });
        }

        function testLatency() {
            const latencyElement = document.getElementById('server-latency');
            const button = latencyElement.nextElementSibling;
            
            button.classList.add('testing');
            button.disabled = true;
            latencyElement.textContent = 'æµ‹è¯•ä¸­...';
            
            const startTime = performance.now();
            
            fetch('/ping', {
                method: 'GET',
                cache: 'no-store'
            })
            .then(() => {
                const latency = Math.round(performance.now() - startTime);
                latencyElement.textContent = latency + ' ms';
                latencyElement.style.color = latency < 200 ? '#32CD32' : latency < 500 ? '#FFA500' : '#FF4500';
            })
            .catch(() => {
                latencyElement.textContent = 'æµ‹è¯•å¤±è´¥';
                latencyElement.style.color = '#FF4500';
            })
            .finally(() => {
                button.classList.remove('testing');
                button.disabled = false;
            });
        }

        function testDownloadSpeed() {
            const speedElement = document.getElementById('download-speed');
            const button = speedElement.nextElementSibling;
            
            button.classList.add('testing');
            button.disabled = true;
            speedElement.textContent = 'æµ‹è¯•ä¸­...';
            
            const startTime = performance.now();
            const testFileSize = 1024 * 1024; // 1MB
            
            fetch('/static/test.bin?' + new Date().getTime(), {
                cache: 'no-store'
            })
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                return response.blob();
            })
            .then(blob => {
                const endTime = performance.now();
                const duration = (endTime - startTime) / 1000;
                const speedMbps = ((testFileSize * 8) / (duration * 1024 * 1024)).toFixed(2);
                
                speedElement.textContent = `${speedMbps} Mbps`;
                speedElement.style.color = speedMbps > 5 ? '#32CD32' : speedMbps > 1 ? '#FFA500' : '#FF4500';
            })
            .catch(() => {
                speedElement.textContent = 'æµ‹è¯•å¤±è´¥';
                speedElement.style.color = '#FF4500';
            })
            .finally(() => {
                button.classList.remove('testing');
                button.disabled = false;
            });
        }

        function testUploadSpeed() {
            const speedElement = document.getElementById('upload-speed');
            const button = speedElement.nextElementSibling;
            
            button.classList.add('testing');
            button.disabled = true;
            speedElement.textContent = 'æµ‹è¯•ä¸­...';
            
            const testData = new Blob([new ArrayBuffer(512 * 1024)]); // 512KB
            const formData = new FormData();
            formData.append('speedtest', testData);
            
            const startTime = performance.now();
            
            fetch('/speedtest', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) throw new Error('Network response was not ok');
                const endTime = performance.now();
                const duration = (endTime - startTime) / 1000;
                const speedMbps = ((512 * 8) / (duration * 1024)).toFixed(2);
                
                speedElement.textContent = `${speedMbps} Mbps`;
                speedElement.style.color = speedMbps > 5 ? '#32CD32' : speedMbps > 1 ? '#FFA500' : '#FF4500';
            })
            .catch(() => {
                speedElement.textContent = 'æµ‹è¯•å¤±è´¥';
                speedElement.style.color = '#FF4500';
            })
            .finally(() => {
                button.classList.remove('testing');
                button.disabled = false;
            });
        }

        function testDNS() {
            const dnsElement = document.getElementById('dns-lookup');
            const button = dnsElement.nextElementSibling;
            
            button.classList.add('testing');
            button.disabled = true;
            dnsElement.textContent = 'æµ‹è¯•ä¸­...';
            
            const dnsStart = performance.now();
            const testDomain = 'www.google.com';
            
            fetch(`https://${testDomain}/favicon.ico`, { mode: 'no-cors' })
                .then(() => {
                    const dnsTime = performance.now() - dnsStart;
                    dnsElement.textContent = `${Math.round(dnsTime)} ms`;
                    dnsElement.style.color = dnsTime < 100 ? '#32CD32' : dnsTime < 300 ? '#FFA500' : '#FF4500';
                })
                .catch(() => {
                    dnsElement.textContent = 'æµ‹è¯•å¤±è´¥';
                    dnsElement.style.color = '#FF4500';
                })
                .finally(() => {
                    button.classList.remove('testing');
                    button.disabled = false;
                });
        }

        function checkNetworkStatus() {
            const statusElement = document.getElementById('connection-status');
            const bandwidthElement = document.getElementById('bandwidth-limit');
            const dnsLookupElement = document.getElementById('dns-lookup');
            const uploadSpeedElement = document.getElementById('upload-speed');
            const downloadSpeedElement = document.getElementById('download-speed');

            // æ£€æŸ¥ç½‘ç»œåœ¨çº¿çŠ¶æ€
            function updateOnlineStatus() {
                statusElement.textContent = navigator.onLine ? 'åœ¨çº¿' : 'ç¦»çº¿';
                statusElement.style.color = navigator.onLine ? '#32CD32' : '#FF4500';
            }
            window.addEventListener('online', updateOnlineStatus);
            window.addEventListener('offline', updateOnlineStatus);
            updateOnlineStatus();

            // æ£€æŸ¥å¸¦å®½é™åˆ¶
            if ('connection' in navigator) {
                const conn = navigator.connection;
                if (conn.downlinkMax) {
                    bandwidthElement.textContent = `${conn.downlinkMax} Mbps`;
                    } else {
                    bandwidthElement.textContent = 'æœªçŸ¥';
                }
            }

            // æµ‹é‡DNSè§£ææ—¶é—´
            const dnsStart = performance.now();
            const testDomain = 'www.google.com';
            fetch(`https://${testDomain}/favicon.ico`, { mode: 'no-cors' })
                .then(() => {
                    const dnsTime = performance.now() - dnsStart;
                    dnsLookupElement.textContent = `${Math.round(dnsTime)} ms`;
                })
                .catch(() => {
                    dnsLookupElement.textContent = 'æµ‹è¯•å¤±è´¥';
                });

            // å®šæœŸæ›´æ–°ç½‘ç»œçŠ¶æ€
            setInterval(() => {
                if ('connection' in navigator) {
                    const conn = navigator.connection;
                    if (conn.downlink) {
                        downloadSpeedElement.textContent = `${conn.downlink} Mbps`;
                    }
                }
            }, 10000);
        }

        function toggleNetworkInfo() {
            const content = document.querySelector('.network-info-content');
            const icon = document.querySelector('.network-info-header .toggle-icon');
            content.classList.toggle('show');
            icon.classList.toggle('rotated');
            
            if (content.classList.contains('show')) {
                checkNetworkStatus();
            }
        }

        function updateSystemInfo() {
            // è·å–æµè§ˆå™¨ä¿¡æ¯
            const browserInfo = document.getElementById('browser-info');
            const ua = navigator.userAgent;
            let browser = 'Unknown';
            if (ua.includes('Chrome')) browser = 'Chrome';
            else if (ua.includes('Firefox')) browser = 'Firefox';
            else if (ua.includes('Safari')) browser = 'Safari';
            else if (ua.includes('Edge')) browser = 'Edge';
            else if (ua.includes('MSIE') || ua.includes('Trident/')) browser = 'Internet Explorer';
            browserInfo.textContent = browser;

            // è·å–æµè§ˆå™¨è¯­è¨€
            const browserLanguage = document.getElementById('browser-language');
            browserLanguage.textContent = navigator.language || navigator.userLanguage || 'æœªçŸ¥';

            // è·å–è®¾å¤‡ç±»å‹å’Œæ“ä½œç³»ç»Ÿä¿¡æ¯
            const deviceType = document.getElementById('device-type');
            const osInfo = document.getElementById('os-info');
            const uaLower = navigator.userAgent.toLowerCase();
            
            // æ›´å‡†ç¡®çš„è®¾å¤‡ç±»å‹æ£€æµ‹
            if (/ipad|android(?!.*mobile)/i.test(uaLower)) {
                deviceType.textContent = 'å¹³æ¿è®¾å¤‡';
            } else if (/iphone|android|webos|blackberry|iemobile|opera mini/i.test(uaLower)) {
                deviceType.textContent = 'ç§»åŠ¨è®¾å¤‡';
            } else if (/macintosh|windows|linux/i.test(uaLower)) {
                deviceType.textContent = 'æ¡Œé¢è®¾å¤‡';
            } else {
                deviceType.textContent = 'æœªçŸ¥è®¾å¤‡';
            }

            // æ›´è¯¦ç»†çš„æ“ä½œç³»ç»Ÿæ£€æµ‹
            let os = 'Unknown';
            if (uaLower.includes('harmonyos')) {
                os = 'HarmonyOS';  // é¸¿è’™ç³»ç»Ÿ
            } else if (uaLower.includes('windows')) {
                if (uaLower.includes('windows nt 10.0')) os = 'Windows 10/11';
                else if (uaLower.includes('windows nt 6.3')) os = 'Windows 8.1';
                else if (uaLower.includes('windows nt 6.2')) os = 'Windows 8';
                else if (uaLower.includes('windows nt 6.1')) os = 'Windows 7';
                else os = 'Windows';
            } else if (uaLower.includes('mac')) {
                if (uaLower.includes('iphone')) os = 'iOS';
                else if (uaLower.includes('ipad')) os = 'iPadOS';
                else os = 'macOS';
            } else if (uaLower.includes('android')) {
                const match = uaLower.match(/android\s([0-9.]+)/);
                os = match ? `Android ${match[1]}` : 'Android';
            } else if (uaLower.includes('linux')) {
                if (uaLower.includes('ubuntu')) os = 'Ubuntu';
                else if (uaLower.includes('fedora')) os = 'Fedora';
                else if (uaLower.includes('debian')) os = 'Debian';
                else if (uaLower.includes('centos')) os = 'CentOS';
                else os = 'Linux';
            } else if (uaLower.includes('cros')) {
                os = 'Chrome OS';
            }
            osInfo.textContent = os;

            // è·å–è®¾å¤‡åƒç´ æ¯”
            const pixelRatio = document.getElementById('pixel-ratio');
            pixelRatio.textContent = window.devicePixelRatio.toFixed(2);

            // è·å–å±å¹•åˆ†è¾¨ç‡
            const screenResolution = document.getElementById('screen-resolution');
            screenResolution.textContent = `${window.screen.width} x ${window.screen.height}`;

            // è·å–ç½‘ç»œè¿æ¥ç±»å‹
            const connectionType = document.getElementById('connection-type');
            const ip = document.getElementById('visitor-ip').textContent;
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºæœ¬åœ°åœ°å€
            if (ip === '127.0.0.1' || ip === 'localhost' || ip.startsWith('192.168.') || ip.startsWith('10.')) {
                connectionType.textContent = 'æœ¬åœ°ç½‘ç»œ';
            } else if ('connection' in navigator) {
                const conn = navigator.connection;
                let type = 'æœªçŸ¥';
                
                // ä¼˜å…ˆæ£€æŸ¥å®é™…çš„è¿æ¥ç±»å‹
                if (conn.type) {
                    switch (conn.type) {
                        case 'wifi':
                            type = 'WiFi';
                            break;
                        case 'cellular':
                            // å¦‚æœæ˜¯ç§»åŠ¨ç½‘ç»œï¼Œå†æ£€æŸ¥å…·ä½“çš„ç½‘ç»œä»£
                            if (conn.effectiveType) {
                                switch (conn.effectiveType) {
                                    case 'slow-2g':
                                        type = '2Gå¼±ç½‘';
                                        break;
                                    case '2g':
                                        type = '2G';
                                        break;
                                    case '3g':
                                        type = '3G';
                                        break;
                                    case '4g':
                                        type = '4G/LTE';
                                        break;
                                    default:
                                        type = 'ç§»åŠ¨ç½‘ç»œ';
                                }
                            } else {
                                type = 'ç§»åŠ¨ç½‘ç»œ';
                            }
                            break;
                        case 'ethernet':
                            type = 'æœ‰çº¿ç½‘ç»œ';
                            break;
                        case 'none':
                            type = 'ç¦»çº¿';
                            break;
                        default:
                            // å¦‚æœtypeæ— æ³•åˆ¤æ–­ï¼Œä½¿ç”¨effectiveType
                            if (conn.effectiveType) {
                                switch (conn.effectiveType) {
                                    case 'slow-2g':
                                        type = 'ä½é€Ÿç½‘ç»œ';
                                        break;
                                    case '2g':
                                        type = '2G';
                                        break;
                                    case '3g':
                                        type = '3G';
                                        break;
                                    case '4g':
                                        type = '4G/LTE';
                                        break;
                                    default:
                                        type = 'å®½å¸¦ç½‘ç»œ';
                                }
                            }
                    }
                } else if (conn.effectiveType) {
                    // å¦‚æœåªæœ‰effectiveTypeå¯ç”¨
                    switch (conn.effectiveType) {
                        case 'slow-2g':
                            type = 'ä½é€Ÿç½‘ç»œ';
                            break;
                        case '2g':
                            type = '2G';
                            break;
                        case '3g':
                            type = '3G';
                            break;
                        case '4g':
                            type = '4G/LTE';
                            break;
                        default:
                            type = 'å®½å¸¦ç½‘ç»œ';
                    }
                }
                connectionType.textContent = type;
            } else {
                connectionType.textContent = 'æµè§ˆå™¨ä¸æ”¯æŒæ­¤åŠŸèƒ½';
            }
        }

        function changeTimeStyle(style) {
            const timeDisplay = document.querySelector('.time-display');
            // ç§»é™¤æ‰€æœ‰æ ·å¼ç±»
            timeDisplay.classList.remove('time-style-1', 'time-style-2', 'time-style-3', 'time-style-4', 'time-style-5');
            // æ·»åŠ é€‰ä¸­çš„æ ·å¼ç±»
            timeDisplay.classList.add(`time-style-${style}`);
            
            // ä¿å­˜ç”¨æˆ·é€‰æ‹©åˆ° localStorage
            localStorage.setItem('preferredTimeStyle', style);
        }

        function toggleDeviceInfo() {
            const content = document.querySelector('.device-info-content');
            const icon = document.querySelector('.device-info-header .toggle-icon');
            content.classList.toggle('show');
            icon.classList.toggle('rotated');
        }

        // æ·»åŠ å¼‚æ­¥åŠ è½½éŸ³é¢‘çš„å‡½æ•°
        function loadAudioFiles() {
            const audioContainer = document.getElementById('audio-container');
            const audioFiles = [
                { src: '/static/audio/index.mp3', type: 'audio/mpeg' },
                { src: '/static/audio/1.flac', type: 'audio/flac' }
            ];

            audioFiles.forEach(file => {
                // åˆ›å»ºaudioå…ƒç´ 
                const audio = document.createElement('audio');
                audio.controls = true;
                
                // åˆ›å»ºsourceå…ƒç´ 
                const source = document.createElement('source');
                source.src = file.src;
                source.type = file.type;
                
                // æ·»åŠ é”™è¯¯æç¤ºæ–‡æœ¬
                audio.appendChild(source);
                audio.appendChild(document.createTextNode('æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘å…ƒç´ ã€‚'));
                
                // å°†audioå…ƒç´ æ·»åŠ åˆ°å®¹å™¨ä¸­
                audioContainer.appendChild(audio);
                
                // æ·»åŠ åŠ è½½é”™è¯¯å¤„ç†
                audio.onerror = () => {
                    console.error(`Error loading audio file: ${file.src}`);
                };
            });
        }

        // ä¿®æ”¹ç‚¹å‡»ç›‘æ§å¯¹è±¡
        const clickMonitor = {
            clicks: 0,
            lastClickTime: 0,
            warningShown: false,
            monitorPeriod: 30000, // 30ç§’ç›‘æµ‹æœŸ
            banPeriod: 480000,    // 480ç§’(8åˆ†é’Ÿ)å°ç¦æœŸ
            
            // è®°å½•ç‚¹å‡»
            recordClick() {
                const now = Date.now();
                
                // å¦‚æœè·ç¦»ä¸Šæ¬¡ç‚¹å‡»è¶…è¿‡ç›‘æµ‹æœŸï¼Œé‡ç½®è®¡æ•°
                if (now - this.lastClickTime > this.monitorPeriod) {
                    this.clicks = 1;
                    this.warningShown = false;
                } else {
                    this.clicks++;
                }
                
                this.lastClickTime = now;
                
                // æ£€æŸ¥ç‚¹å‡»é¢‘ç‡
                if (this.clicks >= 10 && !this.warningShown) {
                    // æ˜¾ç¤ºè­¦å‘Š
                    alert(`è¯·ä¸è¦é¢‘ç¹ç‚¹å‡»ï¼ç»§ç»­ç‚¹å‡»å°†å°ç¦é¡µé¢${this.banPeriod/1000}ç§’ã€‚`);
                    this.warningShown = true;
                } else if (this.clicks >= 15) {
                    // å¼ºåˆ¶å…³é—­é¡µé¢
                    this.banPage();
                    return true;
                }
                return false;
            },

            // å°ç¦é¡µé¢
            banPage() {
                const banTime = Date.now();
                // ä½¿ç”¨å¤šä¸ªå­˜å‚¨æ–¹å¼æ¥é˜²æ­¢ç»•è¿‡
                localStorage.setItem('pageClosed', banTime.toString());
                sessionStorage.setItem('pageClosed', banTime.toString());
                document.cookie = `pageClosed=${banTime};path=/;max-age=${this.banPeriod/1000}`;
                
                this.showBanPage(this.banPeriod/1000);
            },

            // æ˜¾ç¤ºå°ç¦é¡µé¢
            showBanPage(remainingSeconds) {
                document.body.innerHTML = `
                    <div style="text-align: center; padding: 50px;">
                        <h1>é¡µé¢å·²è¢«å¼ºåˆ¶å…³é—­</h1>
                        <p>ç”±äºæ£€æµ‹åˆ°å¼‚å¸¸é¢‘ç¹çš„ç‚¹å‡»è¡Œä¸ºï¼Œé¡µé¢å·²è¢«å°ç¦ã€‚</p>
                        <p>è¯·ç­‰å¾… ${Math.ceil(remainingSeconds)} ç§’ååˆ·æ–°é¡µé¢ã€‚</p>
                        <p>æ³¨æ„ï¼šä½¿ç”¨éšç§æ¨¡å¼æˆ–æ¸…é™¤æµè§ˆå™¨æ•°æ®ä¸ä¼šé‡ç½®å°ç¦æ—¶é—´ã€‚</p>
                        <p id="countdown">${Math.ceil(remainingSeconds)}</p>
                        
                        <!-- æ·»åŠ ç®¡ç†å‘˜æ¢å¤åŒºåŸŸ -->
                        <div style="margin-top: 30px; padding: 20px; border-top: 1px solid #ddd;">
                            <h3>ç®¡ç†å‘˜æ¢å¤</h3>
                            <input type="password" id="adminPassword" placeholder="è¯·è¾“å…¥ç®¡ç†å‘˜å¯†ç " 
                                style="padding: 5px; margin-right: 10px;">
                            <button onclick="clickMonitor.adminRecover()" 
                                style="padding: 5px 15px; cursor: pointer;">
                                è§£é™¤å°ç¦
                            </button>
                        </div>
                    </div>
                `;
                
                const countdownElement = document.getElementById('countdown');
                const timer = setInterval(() => {
                    remainingSeconds--;
                    countdownElement.textContent = Math.ceil(remainingSeconds);
                    if (remainingSeconds <= 0) {
                        clearInterval(timer);
                        this.clearBan();
                        location.reload();
                    }
                }, 1000);
            },

            // æ¸…é™¤å°ç¦çŠ¶æ€
            clearBan() {
                localStorage.removeItem('pageClosed');
                sessionStorage.removeItem('pageClosed');
                document.cookie = 'pageClosed=;path=/;expires=Thu, 01 Jan 1970 00:00:00 GMT';
            },

            // æ£€æŸ¥æ˜¯å¦åœ¨å°ç¦çŠ¶æ€
            checkBanStatus() {
                const now = Date.now();
                const sources = [
                    localStorage.getItem('pageClosed'),
                    sessionStorage.getItem('pageClosed'),
                    this.getCookie('pageClosed')
                ];

                // ä½¿ç”¨æ‰€æœ‰å­˜å‚¨æºä¸­çš„æœ€æ–°å°ç¦æ—¶é—´
                const banTime = Math.max(...sources.map(time => parseInt(time) || 0));
                
                if (banTime && now - banTime < this.banPeriod) {
                    const remaining = this.banPeriod - (now - banTime);
                    this.showBanPage(remaining/1000);
                    return true;
                }
                return false;
            },

            // è·å–cookieå€¼
            getCookie(name) {
                const match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
                return match ? match[2] : null;
            },

            // æ·»åŠ ç®¡ç†å‘˜æ¢å¤åŠŸèƒ½
            adminRecover() {
                const password = document.getElementById('adminPassword').value;
                
                // å‘é€åˆ°æœåŠ¡å™¨éªŒè¯
                fetch('/api/admin/verify_ban_password', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password: password })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        this.clearBan();
                        alert('å°ç¦å·²è§£é™¤ï¼Œé¡µé¢å°†é‡æ–°åŠ è½½ã€‚');
                        location.reload();
                    } else {
                        alert('ç®¡ç†å‘˜å¯†ç é”™è¯¯ï¼');
                    }
                })
                .catch(error => {
                    alert('éªŒè¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚');
                });
            }
        };

        // ä¿®æ”¹é¡µé¢åŠ è½½æ—¶çš„æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', () => {
            // é¦–å…ˆæ£€æŸ¥å°ç¦çŠ¶æ€
            if (clickMonitor.checkBanStatus()) {
                return;
            }
            
            // å¦‚æœæ²¡æœ‰è¢«å°ç¦ï¼Œç»§ç»­æ­£å¸¸åˆå§‹åŒ–
            const savedStyle = localStorage.getItem('preferredTimeStyle');
            if (savedStyle) {
                changeTimeStyle(savedStyle);
                document.querySelector('.style-selector select').value = savedStyle;
            }
            updateTime();
            updateSystemInfo();
            loadAudioFiles();
            
            // è®¾ç½®æµ‹è¯•æŒ‰é’®çš„äº‹ä»¶å¤„ç†å™¨
            document.querySelectorAll('.test-btn').forEach(button => {
                const testType = button.dataset.test;
                switch(testType) {
                    case 'latency':
                        button.onclick = () => throttledLatencyTest();
                        break;
                    case 'download':
                        button.onclick = () => throttledDownloadTest();
                        break;
                    case 'upload':
                        button.onclick = () => throttledUploadTest();
                        break;
                    case 'dns':
                        button.onclick = () => throttledDNSTest();
                        break;
                }
            });
        });
        </script>
    </body>
</html>
